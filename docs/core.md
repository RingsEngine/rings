# æ ¸å¿ƒæ¦‚å¿µ

Rings Engine åŸºäºç°ä»£WebGPUæŠ€æœ¯æ„å»ºï¼Œé‡‡ç”¨ç»„ä»¶-å®ä½“ç³»ç»Ÿ(ECS)æ¶æ„ï¼Œæä¾›é«˜æ€§èƒ½çš„3Dæ¸²æŸ“è§£å†³æ–¹æ¡ˆã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)              â”‚
â”‚  â€¢ é«˜çº§APIå°è£…      â€¢ åœºæ™¯ç®¡ç†      â€¢ èµ„æºç®¡ç†               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç»„ä»¶å±‚ (Component Layer)                â”‚
â”‚  â€¢ æ¸²æŸ“ç»„ä»¶        â€¢ å…‰ç…§ç»„ä»¶      â€¢ å˜æ¢ç»„ä»¶                â”‚
â”‚  â€¢ ç‰©ç†ç»„ä»¶        â€¢ åŠ¨ç”»ç»„ä»¶      â€¢ UIç»„ä»¶                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                     â”‚
â”‚  â€¢ WebGPUä¸Šä¸‹æ–‡    â€¢ æ¸²æŸ“ç®¡çº¿      â€¢ æ•°å­¦åº“                  â”‚
â”‚  â€¢ èµ„æºç³»ç»Ÿ        â€¢ äº‹ä»¶ç³»ç»Ÿ      â€¢ å·¥å…·ç±»                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. å¼•æ“æ ¸å¿ƒ (Engine3D)

**Engine3D** æ˜¯å•ä¾‹æ¨¡å¼çš„å¼•æ“å…¥å£ï¼Œè´Ÿè´£æ•´ä¸ªæ¸²æŸ“ç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### ä¸»è¦èŒè´£ï¼š
- WebGPUè®¾å¤‡åˆå§‹åŒ–å’Œä¸Šä¸‹æ–‡ç®¡ç†
- æ¸²æŸ“å¾ªç¯è°ƒåº¦å’Œæ—¶é—´ç®¡ç†
- å…¨å±€èµ„æºç®¡ç†å’Œç¼“å­˜
- è¾“å…¥ç³»ç»Ÿå’Œäº‹ä»¶åˆ†å‘
- æ€§èƒ½ç›‘æ§å’Œè°ƒè¯•æ”¯æŒ

#### ç”Ÿå‘½å‘¨æœŸï¼š
```typescript
// å¼•æ“åˆå§‹åŒ–
await Engine3D.init();

// åˆ›å»ºæ¸²æŸ“è§†å›¾
const view = new View3D();
view.scene = scene;
view.camera = camera;

// å¯åŠ¨æ¸²æŸ“å¾ªç¯
Engine3D.startRenderView(view);
```

### 2. åœºæ™¯ç®¡ç† (Scene3D)

**Scene3D** æ˜¯åœºæ™¯å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ª3Dåœºæ™¯çš„ç¯å¢ƒå’Œå±‚çº§ç»“æ„ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ï¼š
- ç¯å¢ƒå…‰ç…§è®¾ç½®ï¼ˆç¯å¢ƒè´´å›¾ã€æ›å…‰åº¦ï¼‰
- å¤©ç©ºç›’å’ŒèƒŒæ™¯ç®¡ç†
- å…¨å±€é›¾æ•ˆå’Œå¤§æ°”æ¸²æŸ“
- åœºæ™¯å±‚çº§ç®¡ç†
- åŠ¨æ€åŠ è½½å’Œå¸è½½

#### ç¯å¢ƒé…ç½®ï¼š
```typescript
const scene = new Scene3D();
scene.envMap = await Engine3D.res.loadTexture('env.hdr');
scene.exposure = 1.2;
scene.roughness = 0.5;
```

### 3. è§†å›¾ç³»ç»Ÿ (View3D)

**View3D** å®šä¹‰äº†æ¸²æŸ“çš„è§†å£å’Œè¾“å‡ºç›®æ ‡ï¼Œè¿æ¥åœºæ™¯ã€ç›¸æœºå’Œæ¸²æŸ“è¡¨é¢ã€‚

#### æ ¸å¿ƒå±æ€§ï¼š
- **scene**: å…³è”çš„åœºæ™¯å®ä¾‹
- **camera**: æ¸²æŸ“ä½¿ç”¨çš„ç›¸æœº
- **canvas**: æ¸²æŸ“ç›®æ ‡ç”»å¸ƒ
- **renderTarget**: ç¦»å±æ¸²æŸ“ç›®æ ‡

### 4. ç›¸æœºç³»ç»Ÿ (Camera3D)

**Camera3D** æä¾›é€è§†å’Œæ­£äº¤æŠ•å½±ï¼Œæ”¯æŒå¤šç§ç›¸æœºæ§åˆ¶æ¨¡å¼ã€‚

#### æŠ•å½±ç±»å‹ï¼š
- **é€è§†æŠ•å½±**ï¼šæ¨¡æ‹Ÿäººçœ¼è§†è§‰ï¼Œé€‚ç”¨äº3Dåœºæ™¯
- **æ­£äº¤æŠ•å½±**ï¼šæ— é€è§†å˜å½¢ï¼Œé€‚ç”¨äº2D/UIæ¸²æŸ“

#### é«˜çº§ç‰¹æ€§ï¼š
- çº§è”é˜´å½±æ˜ å°„(CSM)æ”¯æŒ
- è§†é”¥ä½“å‰”é™¤ä¼˜åŒ–
- åŠ¨æ€åˆ†è¾¨ç‡ç¼©æ”¾
- å¤šç›¸æœºæ¸²æŸ“åˆ†å±‚

```typescript
import { Object3D, Camera3D } from '@rings/core';

const camera = new Object3D();
const camera3D = camera.addComponent(Camera3D);
camera3D.perspective(60, aspect, 0.1, 1000);
camera3D.enableCSM = true;
```

### 5. å®ä½“ç³»ç»Ÿ (Object3D)

**Object3D** æ˜¯æ‰€æœ‰3Då¯¹è±¡çš„åŸºç±»ï¼Œé‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒçµæ´»çš„æ‰©å±•ã€‚

#### æ ¸å¿ƒç‰¹æ€§ï¼š
- **å±‚çº§å˜æ¢**ï¼šæ”¯æŒçˆ¶å­å…³ç³»å’Œç›¸å¯¹å˜æ¢
- **ç»„ä»¶ç³»ç»Ÿ**ï¼šåŠ¨æ€æ·»åŠ /ç§»é™¤åŠŸèƒ½ç»„ä»¶
- **äº‹ä»¶ç³»ç»Ÿ**ï¼šå˜æ¢å’Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- **å¯¹è±¡æ± **ï¼šå†…å­˜ä¼˜åŒ–å’Œå¤ç”¨

#### ç»„ä»¶æ¶æ„ï¼š
```typescript
import { Object3D, Transform, MeshRenderer, BoxGeometry, LitMaterial, Vector3 } from '@rings/core';

const obj = new Object3D();

// æ·»åŠ å˜æ¢ç»„ä»¶
const transform = obj.addComponent(Transform);
transform.localPosition = new Vector3(0, 1, 0);

// æ·»åŠ æ¸²æŸ“ç»„ä»¶
const renderer = obj.addComponent(MeshRenderer);
renderer.geometry = new BoxGeometry();
renderer.material = new LitMaterial();

// æ·»åŠ åˆ°åœºæ™¯
scene.addChild(obj);
```

## ğŸ”„ æ¸²æŸ“ç®¡çº¿

### å‰å‘æ¸²æŸ“ç®¡çº¿

Rings Engine é‡‡ç”¨ä¼˜åŒ–çš„å‰å‘æ¸²æŸ“æ¶æ„ï¼Œæ”¯æŒç°ä»£GPUç‰¹æ€§ï¼š

```mermaid
graph TD
    A[åœºæ™¯éå†] --> B[å¯è§æ€§å‰”é™¤]
    B --> C[æè´¨æ’åº]
    C --> D[æ¸²æŸ“é˜Ÿåˆ—]
    D --> E[ä¸é€æ˜ç‰©ä½“]
    D --> F[å¤©ç©ºç›’]
    D --> G[é€æ˜ç‰©ä½“]
    E --> H[åå¤„ç†]
    F --> H
    G --> H
    H --> I[æœ€ç»ˆè¾“å‡º]
```

#### æ¸²æŸ“é˜¶æ®µï¼š

1. **é¢„æ·±åº¦æ¸²æŸ“**ï¼šç”Ÿæˆæ·±åº¦ç¼“å†²ï¼Œä¼˜åŒ–åç»­æ¸²æŸ“
2. **ä¸»æ¸²æŸ“é€šé“**ï¼šå¤„ç†ä¸é€æ˜å’Œé€æ˜ç‰©ä½“
3. **å¤©ç©ºç›’æ¸²æŸ“**ï¼šç¯å¢ƒèƒŒæ™¯å’Œåå°„
4. **åå¤„ç†æ•ˆæœ**ï¼šæŠ—é”¯é½¿ã€è‰²è°ƒæ˜ å°„ã€Bloomç­‰

### å¤šå…‰æºæ”¯æŒ

#### å…‰æºç±»å‹ï¼š
- **æ–¹å‘å…‰(DirectionalLight)**ï¼šæ¨¡æ‹Ÿå¤ªé˜³å…‰ï¼Œæ”¯æŒé˜´å½±
- **ç‚¹å…‰æº(PointLight)**ï¼šå…¨å‘å…‰æºï¼Œæ”¯æŒè¡°å‡
- **èšå…‰ç¯(SpotLight)**ï¼šé”¥å½¢å…‰æŸï¼Œæ”¯æŒå†…å¤–è§’
- **åŒºåŸŸå…‰(AreaLight)**ï¼šçŸ©å½¢/åœ†å½¢é¢å…‰æº

#### å…‰ç…§ç‰¹æ€§ï¼š
- **å®æ—¶é˜´å½±**ï¼šPCFè½¯é˜´å½±ã€CSMçº§è”é˜´å½±
- **å…¨å±€å…‰ç…§**ï¼šDDGIæ¢é’ˆç³»ç»Ÿ
- **åå°„æ¢é’ˆ**ï¼šç¯å¢ƒåå°„å’Œé•œé¢åå°„
- **å…‰ç…§å‰”é™¤**ï¼šåŸºäºç“¦ç‰‡çš„å»¶è¿Ÿå…‰ç…§

## ğŸ¨ æè´¨ç³»ç»Ÿ

### PBRæè´¨å·¥ä½œæµ

åŸºäºç‰©ç†çš„æ¸²æŸ“(PBR)æè´¨ç³»ç»Ÿï¼Œæ”¯æŒé‡‘å±åº¦/ç²—ç³™åº¦å·¥ä½œæµï¼š

#### æè´¨å±æ€§ï¼š
- **Base Color**ï¼šè¡¨é¢åŸºç¡€é¢œè‰²
- **Metallic**ï¼šé‡‘å±åº¦ (0-1)
- **Roughness**ï¼šç²—ç³™åº¦ (0-1)
- **Normal Map**ï¼šæ³•çº¿è´´å›¾
- **Emissive**ï¼šè‡ªå‘å…‰é¢œè‰²
- **AO Map**ï¼šç¯å¢ƒå…‰é®è”½

#### æè´¨ç±»å‹ï¼š
- **LitMaterial**ï¼šæ ‡å‡†PBRæè´¨
- **UnLitMaterial**ï¼šæ— å…‰ç…§æè´¨
- **CustomMaterial**ï¼šè‡ªå®šä¹‰ç€è‰²å™¨

```typescript
const material = new LitMaterial();
material.baseColor = new Color(1.0, 0.5, 0.2);
material.metallic = 0.8;
material.roughness = 0.3;
material.normalTexture = normalMap;
```

## ğŸ—‚ï¸ èµ„æºç®¡ç†

### èµ„æºåŠ è½½ç³»ç»Ÿ

**Res** ç±»æä¾›ç»Ÿä¸€çš„èµ„æºç®¡ç†å’ŒåŠ è½½æ¥å£ï¼š

#### æ”¯æŒçš„æ ¼å¼ï¼š
- **3Dæ¨¡å‹**ï¼šGLTFã€GLBã€OBJã€FBX
- **çº¹ç†**ï¼šPNGã€JPGã€HDRã€KTX2
- **éŸ³é¢‘**ï¼šMP3ã€WAVã€OGG
- **å­—ä½“**ï¼šTTFã€OTFã€FNT

#### åŠ è½½ç¤ºä¾‹ï¼š
```typescript
// åŠ è½½3Dæ¨¡å‹
const model = await Engine3D.res.loadGltf('model.gltf');
scene.addChild(model);

// åŠ è½½çº¹ç†
const texture = await Engine3D.res.loadTexture('diffuse.png');
material.baseTexture = texture;

// åŠ è½½HDRç¯å¢ƒè´´å›¾
const env = await Engine3D.res.loadTexture('env.hdr', { type: 'hdr' });
scene.envMap = env;
```

### èµ„æºç¼“å­˜ç­–ç•¥

- **LRUç¼“å­˜**ï¼šåŸºäºä½¿ç”¨é¢‘ç‡çš„è‡ªåŠ¨æ¸…ç†
- **å‹ç¼©çº¹ç†**ï¼šBCnæ ¼å¼å‡å°‘å†…å­˜å ç”¨
- **å¼‚æ­¥åŠ è½½**ï¼šæ”¯æŒå¹¶å‘åŠ è½½å’Œè¿›åº¦å›è°ƒ
- **å¯¹è±¡æ± **ï¼šå‡ ä½•ä½“å’Œæè´¨å¤ç”¨

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### GPUä¼˜åŒ–æŠ€æœ¯

| ä¼˜åŒ–æŠ€æœ¯ | å®ç°æ–¹å¼ | æ€§èƒ½æå‡ |
|----------|----------|----------|
| **å®ä¾‹åŒ–æ¸²æŸ“** | GPU Instancing | 10x+ å¯¹è±¡æ•°é‡ |
| **é®æŒ¡å‰”é™¤** | å±‚çº§Z-Buffer | 50%+ ç»˜åˆ¶è°ƒç”¨å‡å°‘ |
| **æè´¨åˆå¹¶** | åŠ¨æ€åˆæ‰¹ | 30%+ CPUå¼€é”€é™ä½ |
| **çº¹ç†å‹ç¼©** | BCnæ ¼å¼ | 75% å†…å­˜å ç”¨å‡å°‘ |
| **ç€è‰²å™¨ç¼“å­˜** | é¢„ç¼–è¯‘ç®¡çº¿ | 90% ç¼–è¯‘æ—¶é—´å‡å°‘ |

### å†…å­˜ç®¡ç†

- **å¯¹è±¡æ± åŒ–**ï¼šå‡å°‘GCå‹åŠ›
- **çº¹ç†æµé€**ï¼šæŒ‰éœ€åŠ è½½é«˜åˆ†è¾¨ç‡çº¹ç†
- **å‡ ä½•ä½“LOD**ï¼šåŸºäºè·ç¦»çš„æ¨¡å‹ç®€åŒ–
- **å…‰ç…§å‰”é™¤**ï¼šè§†é”¥ä½“å’Œè·ç¦»å‰”é™¤

## ğŸ¯ æœ€ä½³å®è·µ

### åœºæ™¯æ„å»ºå»ºè®®

1. **å±‚çº§ç»“æ„**ï¼šåˆç†ä½¿ç”¨çˆ¶å­å…³ç³»ç®¡ç†å˜æ¢
2. **ç»„ä»¶ç»„åˆ**ï¼šæŒ‰éœ€æ·»åŠ åŠŸèƒ½ç»„ä»¶ï¼Œé¿å…è¿‡åº¦è®¾è®¡
3. **èµ„æºä¼˜åŒ–**ï¼šä½¿ç”¨å‹ç¼©çº¹ç†å’Œç®€åŒ–å‡ ä½•ä½“
4. **å…‰ç…§è®¾ç½®**ï¼šå¹³è¡¡è´¨é‡å’Œæ€§èƒ½çš„å…‰ç…§é…ç½®

### æ€§èƒ½ç›‘æ§

```typescript
// å¯ç”¨æ€§èƒ½ç»Ÿè®¡
Engine3D.stats.showStats = true;

// ç›‘æ§æ¸²æŸ“ä¿¡æ¯
Engine3D.stats.onUpdate = (stats) => {
    console.log(`FPS: ${stats.fps}`);
    console.log(`Draw Calls: ${stats.drawCalls}`);
    console.log(`Triangles: ${stats.triangles}`);
};
```

## ğŸ”— ç›¸å…³èµ„æº

- [ç»„ä»¶ç³»ç»Ÿè¯¦è§£ â†’](/components)
- [ç€è‰²å™¨å¼€å‘æŒ‡å— â†’](/shaders)
- [åå¤„ç†æ•ˆæœ â†’](/post-processing)
- [APIå‚è€ƒæ–‡æ¡£ â†’](/classes/Engine3D.md)
